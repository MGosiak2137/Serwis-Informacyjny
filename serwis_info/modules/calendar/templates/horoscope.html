{% extends "template.html" %}

{% block title %}Horoskop Tygodniowy{% endblock %}

{% block body_class %}horoscope-layout{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/calendar/static/style.css">
{% endblock %}

{% block content %}
<div class="horoscope-container">
  <div class="horoscope-header">
    <h1> Horoskop Tygodniowy</h1>
    <p class="subtitle">Wybierz swój znak zodiaku, aby odkryć horoskop na bieżący tydzień:</p>
  </div>
  
  <div class="zodiac-section">
    <div class="zodiac-grid" id="zodiacGrid">
      <!-- Przyciski znaków zodiaku zostaną wypełnione przez JavaScript -->
    </div>
  </div>
  
  <div class="results-section">
    <div class="loading" id="loading" style="display: none;">
      <div class="spinner"></div>
      <p>Ładowanie horoskopu z kosmosu...</p>
    </div>
    
    <div class="error" id="error" style="display: none;"></div>
    
    <div class="horoscope-result" id="horoscopeResult" style="display: none;">
      <div class="result-header">
        <h2 id="zodiacTitle"></h2>
        <div class="zodiac-icon" id="zodiacIcon"></div>
      </div>
      <div class="horoscope-content">
        <div class="prediction-card">
          <h3><i class="bi bi-chat-quote"></i> Twoja przepowiednia</h3>
          <div id="horoscopeText" class="prediction-text"></div>
        </div>
        <div class="additional-info" id="additionalInfo" style="display: none;">
          <div class="info-grid">
            <div class="info-item">
              <i class="bi bi-emoji-smile"></i>
              <span>Nastrój: <span id="moodText"></span></span>
            </div>
            <div class="info-item">
              <i class="bi bi-heart"></i>
              <span>Kompatybilność: <span id="compatibilityText"></span></span>
            </div>
            <div class="info-item">
              <i class="bi bi-dice-5"></i>
              <span>Szczęśliwa liczba: <span id="luckyNumber"></span></span>
            </div>
            <div class="info-item">
              <i class="bi bi-clock"></i>
              <span>Szczęśliwa godzina: <span id="luckyTime"></span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
<script>
  const zodiacSigns = [
    'baran', 'byk', 'bliznieta', 'rak', 
    'lew', 'panna', 'waga', 'skorpion', 
    'strzelec', 'koziorozec', 'wodnik', 'ryby'
  ];
  
  const zodiacPolishNames = {
    'baran': 'Baran ♈︎', 'byk': 'Byk ♉︎', 'bliznieta': 'Bliźnięta ♊︎',
    'rak': 'Rak ♋︎', 'lew': 'Lew ♌︎', 'panna': 'Panna ♍︎',
    'waga': 'Waga ♎︎', 'skorpion': 'Skorpion ♏︎', 'strzelec': 'Strzelec ♐︎',
    'koziorozec': 'Koziorożec ♑︎', 'wodnik': 'Wodnik ♒︎', 'ryby': 'Ryby ♓︎'
  };

  const zodiacIcons = {
    'baran': '♈︎', 'byk': '♉︎', 'bliznieta': '♊︎',
    'rak': '♋︎', 'lew': '♌︎', 'panna': '♍︎',
    'waga': '♎︎', 'skorpion': '♏︎', 'strzelec': '♐︎',
    'koziorozec': '♑︎', 'wodnik': '♒︎', 'ryby': '♓︎'
  };
  
  // Wypełnij siatkę przycisków znaków zodiaku
  const zodiacGrid = document.getElementById('zodiacGrid');
  zodiacSigns.forEach(sign => {
    const button = document.createElement('button');
    button.className = 'zodiac-btn';
    button.innerHTML = `
      <div class="zodiac-btn-content">
        <span class="zodiac-symbol">${zodiacIcons[sign]}</span>
        <span class="zodiac-name">${zodiacPolishNames[sign].replace('♈', '').replace('♉', '').replace('♊', '').replace('♋', '').replace('♌', '').replace('♍', '').replace('♎', '').replace('♏', '').replace('♐', '').replace('♑', '').replace('♒', '').replace('♓', '').trim()}</span>
      </div>
    `;
    button.onclick = (e) => loadHoroscope(sign, e.currentTarget);
    zodiacGrid.appendChild(button);
  });
  
  async function loadHoroscope(sign, buttonElement) {
    const loading = document.getElementById('loading');
    const result = document.getElementById('horoscopeResult');
    const errorDiv = document.getElementById('error');
    const additionalInfo = document.getElementById('additionalInfo');
    
    // Pokaż loading, ukryj wynik i błędy
    loading.style.display = 'flex';
    result.style.display = 'none';
    errorDiv.style.display = 'none';
    additionalInfo.style.display = 'none';
    
    // Zaznacz aktywny przycisk
    document.querySelectorAll('.zodiac-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    if (buttonElement) {
      buttonElement.classList.add('active');
    }
    
    try {
      const response = await fetch(`/calendar/api/horoscope/${sign}`);
      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.detail || 'Błąd API');
      }
      
      // Aktualizuj UI z danymi horoskopu
      document.getElementById('zodiacTitle').textContent = zodiacPolishNames[sign];
      document.getElementById('zodiacIcon').textContent = zodiacIcons[sign];
      document.getElementById('horoscopeText').textContent = data.horoscope;
      
      // Dodatkowe informacje jeśli dostępne
      if (data.mood || data.compatibility || data.lucky_number || data.lucky_time) {
        if (data.mood) document.getElementById('moodText').textContent = data.mood;
        if (data.compatibility) document.getElementById('compatibilityText').textContent = data.compatibility;
        if (data.lucky_number) document.getElementById('luckyNumber').textContent = data.lucky_number;
        if (data.lucky_time) document.getElementById('luckyTime').textContent = data.lucky_time;
        additionalInfo.style.display = 'block';
      }
      
      // Pokaż wynik, ukryj loading
      loading.style.display = 'none';
      result.style.display = 'block';
      
      // Przewiń do sekcji wyników
      const resultsSection = document.querySelector('.results-section');
      if (resultsSection) {
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      
    } catch (error) {
      console.error('Błąd:', error);
      loading.style.display = 'none';
      errorDiv.innerHTML = `
        <i class="bi bi-exclamation-triangle"></i>
        <strong>Błąd:</strong> ${error.message}
      `;
      errorDiv.style.display = 'block';
    }
  }
</script>
{% endblock %}