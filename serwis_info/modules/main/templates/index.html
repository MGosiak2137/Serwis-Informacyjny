{% extends "template.html" %}

{% block title %}Strona główna – Serwis informacyjny{% endblock %}

{% block body_class %}home-page{% endblock %}

{% block extra_css %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('main.static', filename='mainpage.css') }}">
    <link rel="stylesheet" href="{{ url_for('main.static', filename='calendar.css') }}">
    <link rel="stylesheet" href="{{ url_for('main.static', filename='weather_card.css') }}">
    <link rel="stylesheet" href="{{ url_for('main.static', filename='economy_card.css') }}">
    <link rel="stylesheet" href="{{ url_for('main.static', filename='news_card.css') }}">
    {% if show_welcome_modal %}
    <link rel="stylesheet" href="{{ url_for('main.static', filename='welcome_modal.css') }}">
    {% endif %}
{% endblock %}

{% block extra_js %}
    {{ super() }}
    <script src="{{ url_for ('main.static', filename='news_carousel.js' )}}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('main.static', filename='script.js') }}"></script>
    {% if show_welcome_modal %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'), {
          backdrop: 'static',
          keyboard: false
        });
        welcomeModal.show();
      });
    </script>
    {% endif %}
{% endblock %}
{% block content %}
<section class="home-layout" aria-label="Nawigacja po modułach serwisu">
  <div class="cards-grid">

    {# LEWA KOLUMNA: KALENDARZ + NEWS #}
    <div class="col-left">

      <a href="{{ url_for('horoscope.horoscope_page') }}" class="card-item card-calendar">

        <div class="calendar-horizontal">

          <div class="calendar-left">
            <div class="calendar-time" id="calendar-time">Ładowanie...</div>
            <div class="calendar-date" id="calendar-date">Ładowanie...</div>
          </div>

          <div class="calendar-right">

            <div class="calendar-box">
              <span class="calendar-label">Imieniny:</span>
              <span class="calendar-value" id="calendar-namedays">Ładowanie...</span>
            </div>

            <div class="calendar-box">
              <span class="calendar-label">Status dnia:</span>
              <span class="calendar-value" id="calendar-dayoff">Ładowanie...</span>
            </div>

            <div class="calendar-box">
              <span class="calendar-label">Święto:</span>
              <span class="calendar-value" id="calendar-holiday">Ładowanie...</span>
            </div>

            <div class="calendar-box">
              <span class="calendar-label">Dzień roku:</span>
              <span class="calendar-value" id="calendar-daynum">Ładowanie...</span>
            </div>

          </div>
        </div>

      </a>

      {# KAFEL – NEWSY #}
      <div class="card-item card-news">

        <div id="newsCarousel" class="carousel slide w-100 h-100" data-bs-ride="carousel">
          <div class="carousel-inner h-100">

            {% if news_preview %}
              {% for item in news_preview %}
              <div class="carousel-item {% if loop.first %}active{% endif %} h-100">
                <a href="{{ url_for('news.news_home') }}" class="news-preview-slide">

                  <div class="news-preview-image-wrapper">
                    {% if item.image_url %}
                      <img src="{{ item.image_url }}"
                           class="news-preview-image"
                           alt="{{ item.title }}">
                    {% else %}
                      <div class="news-preview-image-placeholder">
                        NEWS
                      </div>
                    {% endif %}
                  </div>

                  <div class="news-preview-caption">
                    <h3 class="news-preview-title">{{ item.title }}</h3>
                    <p class="news-preview-summary">{{ item.summary or '' }}</p>
                  </div>

                </a>
              </div>
              {% endfor %}
            {% else %}
              <div class="carousel-item active h-100">
                <a href="{{ url_for('news.news_home') }}" class="news-preview-slide">
                  <div class="news-preview-image-wrapper">
                    <div class="news-preview-image-placeholder">NEWS</div>
                  </div>
                  <div class="news-preview-caption">
                    <h3 class="news-preview-title">Moduł newsowy</h3>
                    <p class="news-preview-summary">
                      Brak danych do wyświetlenia.
                    </p>
                  </div>
                </a>
              </div>
            {% endif %}

          </div>

          {% if news_preview and news_preview|length > 1 %}
          <button class="carousel-control-prev" type="button"
                  data-bs-target="#newsCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button"
                  data-bs-target="#newsCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
          {% endif %}
        </div>

      </div>  {# koniec .card-news #}

    </div>  {# koniec .col-left #}

    {# PRAWA KOLUMNA: POGODA + ECONOMY #}
    <div class="col-right">
      {# KAFEL – POGODA #}
      <a href="{{ url_for('weather_api.dashboard_page') }}" class="card-item card-weather">
        <div class="weather-mini">
          <div class="weather-header">
            <p class="wm-city">Warszawa</p>
            <img id="mini-icon" class="wm-icon" style="display:none;">
          </div>

          <p id="mini-temp" class="wm-temp">Ładowanie...</p>
          <p id="mini-desc" class="wm-desc"></p>

          <div class="weather-forecast-mini" id="forecast-mini">
            Ładowanie prognozy...
            <div class="forecast-row" id="forecast-row"></div>
          </div>
        </div>
      </a>

      {# KAFEL – ECONOMY #}
      <a href="{{ url_for('main_eco.main') }}" class="card-item card-economy">
        <div class="currency-header">
          <div class="usd">
            <div class="currency-line">USD/PLN: <span id="usd-pln">{{ usd_pln if usd_pln else 'brak danych' }}</span></div>
            <div class="spark-row">
              <div class="spark-y-vertical">
                <div class="y-max" id="usd-spark-ymax"></div>
                <div class="y-min" id="usd-spark-ymin"></div>
              </div>
              <div class="spark-canvas-wrap">
                <canvas id="usd-spark" class="sparkline" width="160" height="48"></canvas>
                <div class="spark-x">
                  <span class="x-start" id="usd-spark-xstart"></span>
                  <span class="x-end" id="usd-spark-xend"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="eur">
            <div class="currency-line">EUR/PLN: <span id="eur-pln">{{ eur_pln if eur_pln else 'brak danych' }}</span></div>
            <div class="spark-row">
              <div class="spark-y-vertical">
                <div class="y-max" id="eur-spark-ymax"></div>
                <div class="y-min" id="eur-spark-ymin"></div>
              </div>
              <div class="spark-canvas-wrap">
                <canvas id="eur-spark" class="sparkline" width="160" height="48"></canvas>
                <div class="spark-x">
                  <span class="x-start" id="eur-spark-xstart"></span>
                  <span class="x-end" id="eur-spark-xend"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="gold-section">
          <div class="gold-price">
            Złoto: <span id="gold-price">{{ gold_price|round(2) if gold_price else 'brak danych' }}</span> USD/oz
          </div>
          <canvas id="gold-chart"></canvas>
        </div>
      </a>
    </div>  {# koniec .col-right #}

  </div>
</section>

<!-- Welcome Modal for New Users -->
{% if show_welcome_modal %}
<div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="false" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered welcome-modal-dialog">
    <div class="modal-content welcome-modal-content">
      <div class="modal-header welcome-modal-header">
        <h5 class="modal-title" id="welcomeModalLabel">
          <img src="{{ url_for('static', filename='img/logo2.png') }}" alt="Logo" class="welcome-logo me-2">Witamy w NEWC!
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body welcome-modal-body">
        <p class="welcome-intro">
          Cieszymy się, że dołączyłeś! Oto dostępne moduły:
        </p>
        
        <div class="welcome-modules-grid">
          <div class="welcome-module-item" data-module="horoscope">
            <div class="welcome-module-icon">
              <i class="bi bi-calendar-heart"></i>
            </div>
            <div class="welcome-module-content">
              <h6>Kalendarz i Horoskop</h6>
              <p>Imieniny, święta i horoskop na dziś.</p>
            </div>
          </div>

          <div class="welcome-module-item" data-module="news">
            <div class="welcome-module-icon">
              <i class="bi bi-card-checklist"></i>
            </div>
            <div class="welcome-module-content">
              <h6>Wiadomości</h6>
              <p>Najnowsze wiadomości ze sportu i przestępczości.</p>
            </div>
          </div>

          <div class="welcome-module-item" data-module="weather">
            <div class="welcome-module-icon">
              <i class="bi bi-cloud-sun"></i>
            </div>
            <div class="welcome-module-content">
              <h6>Pogoda</h6>
              <p>Aktualna pogoda i prognoza z interaktywną mapą.</p>
            </div>
          </div>

          <div class="welcome-module-item" data-module="economy">
            <div class="welcome-module-icon">
              <i class="bi bi-coin"></i>
            </div>
            <div class="welcome-module-content">
              <h6>Ekonomia</h6>
              <p>Kursy walut, złoto, giełda i kalkulator walut.</p>
            </div>
          </div>
        </div>

        <div class="welcome-tip">
          <div class="welcome-tip-icon">
            <i class="bi bi-moon-stars"></i>
          </div>
          <div class="welcome-tip-content">
            <strong>Wskazówka:</strong> Przełącz tryb jasny/ciemny przyciskiem <i class="bi bi-moon"></i> w nawigacji.
          </div>
        </div>
      </div>
      <div class="modal-footer welcome-modal-footer">
        <button type="button" class="btn btn-primary welcome-modal-btn" data-bs-dismiss="modal">
          Rozpocznij korzystanie
        </button>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}

